import openpyxl
import pandas as pd

workbook = openpyxl.Workbook()
sheet = workbook.active

Sa = float(input("Введите ставку аренды: "))
APrPl = float(input("Введите арендо-пригодную площадь: "))
Poteru = float(input("Введите потери: "))
Dop_dox = float(input("Введите дополнительный доход: "))
operating_doxod = float(input("Введите операционный доход: "))
step = int(input("Введите шаг расчета или период: "))
zatratu = float(input("Введите затраты за период: "))
Kt = float(input("Введите капитальные вложения: "))
T = int(input("Введите горизонт расчета: "))

df = pd.read_excel('/content/data2.xlsx')
discount_rate = float(df.iloc[0,0])

if pd.isna(discount_rate) or discount_rate is None:
    discount_rate = 0

PVD = Sa * APrPl
DVD = PVD - Poteru + Dop_dox
CHOD = DVD - operating_doxod

cash_flows = [-Kt]
discounted_cash_flows = [cash_flows[0] / (1 + discount_rate)]
for i in range(0, T+1, step): # stock -> 0
    Rt = CHOD
    zt = zatratu + Kt
    cash_flow = Rt - zt
    cash_flows.append(cash_flow)
    if pd.isna(discount_rate) or discount_rate is None:
        discount_rate = 0
    discounted_cash_flow = cash_flow / ((1 + discount_rate) ** (i//step))
    discounted_cash_flows.append(discounted_cash_flow + discounted_cash_flows[-1])

factors = ['Общие экономические тенденции', 'Внешняя экономическая деятельность', 'Инфляция', 'Инвестиция', 'Доходы и сбережения населения', 'Система налогообложения', 'Угроза передела собственности', 'Внутреполитическая стабильность', 'Внешняя политическая деятельность', 'Угроза террористических актов', 'Социальная стабильность в стране', 'Социальная обеспечённость граждан', 'Тенденция развития экономики в регионе', 'Социальная стабильность в регионе', 'Ликвидность', 'Уровень конкуренции в отрасли', 'Инвестиционная привлекательность проекта', 'Тенденция развития отрасли', 'Природные чрезвычайные ситуации', 'Антропогенные чрезвычайные ситуации', 'Ускоренный износ объекта', 'Экологические факторы', 'Криминогенные факторы', 'Финансовые проверки', 'Фактор изменения окружающей застройки', 'Увеличение числа конкурирующих объектов', 'Изменение общей экономической ситуации']

ranks = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10']
factor_cells = {
    'Общие экономические тенденции': 'E4',
    'Внешняя экономическая деятельность': 'E5',
    'Инфляция': 'E6',
    'Инвестиция': 'E7',
    'Доходы и сбережения населения': 'E8',
    'Система налогообложения': 'E9',
    'Угроза передела собственности': 'E10',
    'Внутреполитическая стабильность': 'E11',
    'Внешняя политическая деятельность': 'E12',
    'Угроза террористических актов': 'E13',
    'Социальная стабильность в стране': 'E20',
    'Социальная обеспечённость граждан': 'E21',
    'Тенденция развития экономики в регионе': 'E22',
    'Социальная стабильность в регионе': 'E23',
    'Ликвидность': 'E30',
    'Уровень конкуренции в отрасли': 'E31',
    'Инвестиционная привлекательность проекта': 'E32',
    'Тенденция развития отрасли': 'E33',
    'Природные чрезвычайные ситуации': 'E40',
    'Антропогенные чрезвычайные ситуации': 'E41',
    'Ускоренный износ объекта': 'E42',
    'Экологические факторы': 'E43',
    'Криминогенные факторы': 'E44',
    'Финансовые проверки': 'E45',
    'Фактор изменения окружающей застройки': 'E46',
    'Увеличение числа конкурирующих объектов': 'E47',
    'Изменение общей экономической ситуации': 'E48',
}

rank_cells = {
    '0': 'F2',
    '1': 'G2',
    '2': 'H2',
    '3': 'I2',
    '4': 'J2',
    '5': 'K2',
    '6': 'L2',
    '7': 'M2',
    '8': 'N2',
    '9': 'O2',
    '10': 'P2',
}

for factor in factors:
    rank = input(f'Введите ранг для фактора {factor}: ')
    cell = rank_cells[rank]
    factor_cell = factor_cells[factor]
    sheet[cell].value = 1
    sheet[factor_cell].value = rank

workbook.save('/content/data2.xlsx')

CHDD1 = sum([(Rt - 3*t) / ((1 + discount_rate)**t) for t, Rt in enumerate(cash_flows)])
CHDD2 = sum([(Rt - 3*t) / ((1 + 100)**t) for t, Rt in enumerate(cash_flows)])
E1 = discount_rate
E2 = 100
VND = E1 + (CHDD1 / (CHDD1 - CHDD2)) * (E2 - E1)
if pd.isna(VND) or VND is None:
    VND = 0
print("Дисконтированные потоки денежных средств: ", discounted_cash_flows)
print("Чистая приведенная стоимость: ", round(VND, 2))
